FREQINI EQU -5
POINTS EQU 50

ORG 0x20
sinDB:
DB 0x80,0x8f,0x9f,0xae,0xbd,0xca,0xd7,0xe2,0xeb,0xf3,0xf9,0xfd,0xff,0xff,0xfd,0xf9,0xf3,0xeb,0xe2,0xd7,0xca,0xbd,0xae,0x9f,0x8f,0x80,0x70,0x60,0x51,0x42,0x35,0x28,0x1d,0x14,0xc,0x6,0x2,0x0,0x0,0x2,0x6,0xc,0x14,0x1d,0x28,0x35,0x42,0x51,0x60,0x70

ORG 0
JMP main

ORG 0x70
main:
	;enable DAC
	CLR P0.7
	MOV A, #0
	MOV DPTR, #sinDB
	;enable interruptions
	SETB EA
	SETB ET0 ;timer
	SETB EX0 ;button down
	SETB EX1 ;button up
	SETB IT0
	SETB IT1
	;config interruptions
	MOV TMOD, #00000010b
	MOV B, #FREQINI
	CALL setFreq
	;start interruptions
	SETB TR0
	JMP $

setFreq:
	MOV TH0, B
	MOV TL0, TH0
	RET

moveToDAC:
	MOVC A, @A+DPTR
	MOV P1, A
	RET

ORG 0x03
buttonDownInt:
	DEC B
	CALL setFreq
	RETI

ORG 0x13
buttonUpInt:
	INC B
	CALL setFreq
	RETI

ORG 0x0B
JMP counterInt

ORG 0x120
counterInt:
	CJNE A, #POINTS, dontReset
	MOV A, #0
dontReset:
	PUSH ACC
	CALL moveToDAC
	POP ACC
	INC A
	RETI
